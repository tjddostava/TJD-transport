<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TJD COMPANY DOO - Logistika</title>
    <style>
        /* OSNOVNI STIL I BOJE */
        :root { --primarna: #28a745; --sekundarna: #007bff; --tamna: #2c3e50; --svijetla: #f8f9fa; --siva: #6c757d; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: var(--svijetla); color: var(--tamna); }

        header { background: white; padding: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .logo h1 { margin: 0; color: var(--primarna); letter-spacing: 1px; cursor: pointer; }

        .container { max-width: 800px; margin: 20px auto; padding: 20px; }
        
        /* ADMIN PANEL STIL */
        #adminOkvir { display: none; margin-top: 20px; background: #ebf5fb; padding: 20px; border-radius: 10px; border: 2px solid var(--sekundarna); }
        .admin-statistika { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #f1c40f; text-align: center; }
        
        /* FORMA I DUGMAD */
        .kartica { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        button { width: 100%; padding: 15px; background: var(--primarna); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        button:hover { background: #218838; transform: translateY(-2px); }
        .btn-admin { background: var(--tamna); margin-top: 10px; }
        
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .cekaj { background: #fff3cd; color: #856404; }
        .odobreno { background: #d4edda; color: #155724; }
    </style>
</head>
<body>

<header>
    <div class="logo"><h1 onclick="location.reload()">TJD LOGISTIKA</h1></div>
</header>

<div class="container">
    <div id="adminOkvir">
        <div class="admin-statistika">
            <span style="font-size:0.9rem; color:var(--siva);">UKUPNO POSJETA SAJTU:</span><br>
            <strong style="font-size:1.8rem; color:var(--tamna);" id="brojPosjetaPrikaz">...</strong>
        </div>
        <h3>Upravljanje Narudžbama</h3>
        <div id="listaNarudzbi">Učitavanje...</div>
        <button class="btn-admin" onclick="zatvoriAdmin()">Zatvori Panel</button>
    </div>

    <div id="glavniSadrzaj">
        <div class="kartica">
            <h2>Nova Narudžba / Upit</h2>
            <input type="text" id="ruta" placeholder="Ruta (npr. Podgorica - Beograd)">
            <textarea id="opis" placeholder="Opis robe i napomena"></textarea>
            <input type="text" id="tezina" placeholder="Težina / Dimenzije">
            <button onclick="posaljiNarudzbu()">POŠALJI UPIT</button>
            <button class="btn-admin" onclick="provjeriAdmin()">ADMIN PANEL</button>
        </div>
    </div>
</div>

<script>
    // --- KONFIGURACIJA ---
    const scriptURL = "ZALIJEPI_OVDJE_TVOJ_URL_SKRIPTE"; // Ovdje obavezno zalijepi svoj novi Deployment URL

    // --- BROJAČ POSJETA (POBOLJŠAN) ---
    async function azurirajBrojac() {
        const prikaz = document.getElementById('brojPosjetaPrikaz');
        
        // Ako je već izbrojan u ovoj sesiji (tabu), samo povuci broj bez ponovnog upisa
        if (sessionStorage.getItem('tjd_posjeta_snimljena')) {
            dohvatiSamoBroj();
            return;
        }

        try {
            // Šaljemo "ping" za novu posjetu
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ "akcija": "posjeta" })
            });
            
            sessionStorage.setItem('tjd_posjeta_snimljena', 'true');
            
            // Mala pauza da Google upiše u bazu, pa pročitaj broj
            setTimeout(dohvatiSamoBroj, 1500);
            
        } catch (e) {
            console.log("Greška kod brojača.");
            dohvatiSamoBroj();
        }
    }

    async function dohvatiSamoBroj() {
        const prikaz = document.getElementById('brojPosjetaPrikaz');
        try {
            const res = await fetch(scriptURL + "?getBroj=true");
            const broj = await res.text();
            if (prikaz && !isNaN(broj)) {
                prikaz.innerText = broj;
            }
        } catch (e) { console.log("Ne mogu učitati broj."); }
    }

    // --- LOGIKA ZA NARUDŽBE ---
    async function posaljiNarudzbu() {
        const data = {
            id: Date.now(),
            ruta: document.getElementById('ruta').value,
            opis: document.getElementById('opis').value,
            tezina: document.getElementById('tezina').value,
            akcija: "novaNarudzba"
        };

        if(!data.ruta) return alert("Unesite rutu!");

        try {
            await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(data)
            });
            alert("Narudžba uspješno poslata!");
            location.reload();
        } catch (e) { alert("Greška pri slanju."); }
    }

    // --- ADMIN FUNKCIJE ---
    function provjeriAdmin() {
        const pass = prompt("Unesite admin šifru:");
        if (pass === "123") { // Promijeni šifru po želji
            document.getElementById('glavniSadrzaj').style.display = 'none';
            document.getElementById('adminOkvir').style.display = 'block';
            ucitajNarudzbe();
            dohvatiSamoBroj(); // Osvježi broj čim uđeš
        } else {
            alert("Pogrešna šifra!");
        }
    }

    function zatvoriAdmin() {
        document.getElementById('adminOkvir').style.display = 'none';
        document.getElementById('glavniSadrzaj').style.display = 'block';
    }

    async function ucitajNarudzbe() {
        try {
            const res = await fetch(scriptURL);
            const data = await res.json();
            let html = "";
            data.forEach(n => {
                html += `<div class="kartica" style="font-size:0.9rem;">
                    <strong>ID: ${n.id}</strong><br>
                    Ruta: ${n.ruta}<br>
                    Status: <span class="status-badge ${n.status === 'ODOBRENO' ? 'odobreno' : 'cekaj'}">${n.status}</span>
                </div>`;
            });
            document.getElementById('listaNarudzbi').innerHTML = html || "Nema narudžbi.";
        } catch (e) { 
            document.getElementById('listaNarudzbi').innerText = "Greška pri učitavanju.";
        }
    }

    // POKRENI BROJAČ ODMAH
    window.onload = azurirajBrojac;

</script>

</body>
</html>